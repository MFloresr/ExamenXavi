<!doctype html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="http://bootswatch.com/cosmo/bootstrap.min.css" type="text/css" />
    
</head>
<body ng-app='appLearn'>
    <div class="container" ng-controller="MissatgesController">
        <h1>Darrers Missatges</h1>
        <form role="form">
            <div class="form-group">
                <div class="input-group">
                    <input ng-model="missatgeBody" class="form-control"/>
                    <br>
                    <button class="btn btn-success btn-lg" ng-click="afegirMissatge()">Afegir Missatge</button>
                </div>
            </div>
        </form>
        <div>
            <ul class="list-group">
                <li class="list-group-item" ng-repeat="missatge in missatges | orderBy:'-date'"> 
                    <strong>{{missatge.username}}</strong>
                    <p>{{missatge.body}}</p>
                </li>
            </ul>
            
        </div>
        
        
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.11/angular.min.js"></script>
    <script>
        var app = angular.module('appLearn',[]);
        app.controller('MissatgesController',function($scope,$http) {
                $http.get("api/missatges")
                .success(function(missatges){
                    $scope.missatges = missatges;
                })
                .error(function(e){
                    console.log(e);
                });

                $scope.afegirMissatge = function() {
                    if ($scope.missatgeBody){
                        $http.post("api/missatges",{
                            username: "xavigimenez",
                            body: $scope.missatgeBody
                        }).success(function(missatge) {
                            $scope.missatges.unshift(missatge);
                            $scope.missatgeBody = null;
                        });
                    }
                };
        });
    </script>
</body>
</html>